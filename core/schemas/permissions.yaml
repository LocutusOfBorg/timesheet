# Permissions schema is defined in this way:
#

customer:
  project manager:
    get:
      True


user:
  employee:
    get:
      projections:
        - salt
        - password
      criteria:
        type: object
        properties:
          _id:
            type: string
            pattern: '%%_id%%'
        required: 
          - _id
    update:
        type: object
        properties:
          _id:
            type: string
            pattern: '%%_id%%'
        required: 
          - _id      
  project manager:
    get:
      # Project manager can see every user record but salt, password and salary
      projections:
        - salt
        - password
        - salary       
    update:
        type: object
        properties:
          _id:
            type: string
            pattern: '%%_id%%'
        required: 
          - _id      
    
    
search_trips:
  employee:
    type: object
    required: [ employee_id, user_id ]
    properties:
      employee_id:
        type: string
        pattern: '%%_id%%'        
      user_id:
        type: string
        pattern: '%%_id%%'      
  project manager:
    required: [ responsible_id ]
    type: object
    properties:
      responsible_id:
        type: string
        pattern: '%%_id%%'          

    
search_expences:
  employee:
    type: object
    required: [ employee_id, user_id ]
    properties:
      employee_id:
        type: string
        pattern: '%%_id%%'        
      user_id:
        type: string
        pattern: '%%_id%%'      
  project manager:
    required: [ responsible_id ]
    type: object
    properties:
      responsible_id:
        type: string
        pattern: '%%_id%%' 

    
search_days:
    employee:
        type: object
        properties:
          users.user_id: 
            type: string
            pattern: '%%_id%%'
        required: 
          - users.user_id
                   
    project manager:
        type: object
        properties:
          users.user_id: 
            type: string
            pattern: '%%_id%%'
        required: 
          - users.user_id   

push_days:
    employee:
        type: object
        properties:
          users:
            optional: True
            type: array
            items:
              properties:
                user_id:
                  type: string
                  pattern: '%%_id%%'
    
    project manager:
        type: object
        properties:
          date:
            type: string
          users:
            optional: True
            type: array
            items:
              properties:
                user_id:
                  type: string
                  pattern: '%%_id%%'
                hours:
                  optional: True
                  type: array
                  items: 
                    properties:
                      project:
                        enum : '%%managed_projects%%'


report_users_hours:
    project manager:
        type: object
        properties:
          users.hours.project:
            type: object
            properties: 
              '$in':
                type: array
                items:
                  enum: '%%managed_projects%%'
        required: 
          - users.hours.project

      
  
report_projects:
    project manager:
        type: object
        required : [ 'users.hours.project' ]
        properties:
          users.hours.project:
            type: object
            required: [ '$in' ]
            properties: 
              '$in':
                type: array
                items:
                  enum: '%%managed_projects%%'
   
                  
project:
  employee:
    get:
      criteria:
        type: object
        properties:
          employees._id: 
            type: string
            pattern: '%%_id%%'
        required:
          - employees._id
              
  project manager:
    get:
      criteria:
        oneOf:
          - type: object
            required: [ employees._id ]
            properties:
              employees._id:
                type: string
                pattern: '%%_id%%'
          - type: object
            required: [ responsible._id ]
            properties:
              responsible._id:
                type: string
                pattern: '%%_id%%'
 
    update:
      type: object
      properties:
        _id:
          type: string
          enum: '%%managed_projects%%'


push_trips:
  # employees._id is validated manually
  employee:
        type: object
        required: [ trips ]
        properties:
          trips:
            type: array
            items:
              oneOf:
                - type: object
                  required: [ user_id ]
                  properties:
                    user_id: 
                      type: string
                      pattern: '%%_id%%'
              
  project manager:
      type: object
      properties:
        _id:
          type: string
          enum: '%%projects%%'
          
          
push_expences:
  # employees._id is validated manually
  employee:
        type: object
        required: [ expences ]
        properties:
          expences:
            type: array
            items:
              oneOf:
                - type: object
                  required: [ user_id ]
                  properties:
                    user_id: 
                      type: string
                      pattern: '%%_id%%'
              
  project manager:
      type: object
      properties:
        _id:
          type: string
          enum: '%%projects%%'