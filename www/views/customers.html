<script type="text/javascript">
var isupdate = false;
$(document).ready(function() {
  loadCustomersList("custList");
  $("#custForm").submit(function(event) {
    event.preventDefault();
    customer.update(isupdate, "custForm", resetform);
    loadCustomersList("custList");
  });
  $("#btnreset").click(function() {
    resetform();
    isupdate = false;
  });
  $("#btnremove").click(function() {
    customer.remove($("#cust_id").val(),resetform);
    loadCustomersList("custList");
  });
});

function loadCustomersList(list) {
  var filter = [{},{name:1}];
  customer.load(filter, loadCustomers, list);
}

function resetform() {
  $("#cust_id").val(0);
  $("#custForm")[0].reset();
  $("#btnremove").addClass("hidden");
  $("#custList li").removeClass("active");
  $("#btnsubmit").html("<span class='glyphicon glyphicon-plus'></span> Add");
}
function loadCustomers(data, container) {
  var i;
  var htmllist = "";
  for(i=0;i < data.records.length; i++) {
    htmllist += "<li id='" + data.records[i]._id + "'class='list-group-item'><span class='glyphicon glyphicon-edit'></span> " + data.records[i].name + "</li>";
  }
  //add line for new customer
  htmllist += "<li class='list-group-item'><span class='glyphicon glyphicon-plus'></span> New Customer ...</li>";
  $("#" + container).html(htmllist);
  $(".list-group-item").click(function() {
    $(".list-group-item").removeClass("active");
    $(this).addClass("active");
    isupdate = true;
    var filter = createFilterForm("custForm");
    filter[0]._id = this.id;
    customer.load(filter,loadCustomerDetails, container);
  });
  $(".list-group-item:last").click(function() {
    $("#custForm")[0].reset();
    $("#cust_id").val(0);
    $(".btn-danger").addClass("hidden");
    isupdate = false;
  });
}

function createFilterForm(container) {
  var filter = [{},{}];
  $("#" + container + " input").each(function (){
    var property = $(this).attr("id").substr(4);
    if (property == "_id")
      return;
    filter[1][property] = 1;
  });
  return filter;
}

function loadCustomerDetails(data,container) {
  for(var key in data.records[0]) {
    $("#cust" + key).val( data.records[0][key]);
    $(".btn-danger").removeClass("hidden");
  }
  $("#btnsubmit").html("<span class='glyphicon glyphicon-edit'></span> Update");
}
</script>
<h2>Customer Management</h2>
<div class="row">
    <div class="col-lg-5">
<h3>Current customer list</h3>
<p>Click on a customer to edit its data or to last element to add a new one</p>
<ul class="list-group col-lg-8" id="custList">
</ul>

</div>
<div class="col-lg-6">
<h3>Customer details</h3>

<form class="form-horizontal" role="form" method="post" action="/index/customers" id="custForm">
  <input type="hidden" id="cust_id" value="0">
  <div class="form-group">
    <label for="custname" class="col-lg-4 control-label">Name</label>
    <div class="col-lg-6">
      <input type="text" class="form-control" id="custname" placeholder="Name">
    </div>
  </div>

  <div class="form-group">
    <label for="custdescription" class="col-lg-4 control-label">Description</label>
    <div class="col-lg-6">
      <input type="text" class="form-control" id="custdescription" placeholder="Description">
    </div>
  </div>

<div class="form-group">
    <label for="custaddress" class="col-lg-4 control-label">Address</label>
    <div class="col-lg-6">
      <input type="text" class="form-control" id="custaddress" placeholder="Address">
    </div>
  </div>
<div class="form-group">
    <label for="custcity" class="col-lg-4 control-label">City</label>
    <div class="col-lg-6">
      <input type="text" class="form-control" id="custcity" placeholder="City">
    </div>
  </div>
<div class="form-group">
    <label for="custpostal_code" class="col-lg-4 control-label">Postal Code</label>
    <div class="col-lg-6">
      <input type="text" class="form-control" id="custpostal_code" placeholder="Postal Code">
    </div>
  </div>
<div class="form-group">
    <label for="custcountry" class="col-lg-4 control-label">Country</label>
    <div class="col-lg-6">
      <input type="text" class="form-control" id="custcountry" placeholder="Country">
    </div>
  </div>
<div class="form-group">
    <label for="custvat_number" class="col-lg-4 control-label">VAT</label>
    <div class="col-lg-6">
      <input type="text" class="form-control" id="custvat_number" placeholder="VAT">
    </div>
  </div>
<div class="form-group">
    <label for="custwebsite" class="col-lg-4 control-label">Website</label>
    <div class="col-lg-6">
      <input type="text" class="form-control" id="custwebsite" placeholder="Website">
    </div>
  </div>
<div class="form-group">
    <label for="custcontact_person" class="col-lg-4 control-label">Contact Person</label>
    <div class="col-lg-6">
      <input type="text" class="form-control" id="custcontact_person" placeholder="Contact Person">
    </div>
  </div>
<div class="form-group">
    <label for="custphone" class="col-lg-4 control-label">Phone</label>
    <div class="col-lg-6">
      <input type="text" class="form-control" id="custphone" placeholder="Phone">
    </div>
  </div>
<div class="form-group">
    <label for="custemail" class="col-lg-4 control-label">Email</label>
    <div class="col-lg-6">
      <input type="email" class="form-control" id="custemail" placeholder="Email">
    </div>
  </div>
  <div class="form-group">
    <div class="col-lg-offset-4 col-lg-6">
      <button type="submit" class="btn btn-primary" id="btnsubmit"><span class="glyphicon glyphicon-plus"></span> Add</button>
      <button type="reset" class="btn" id="btnreset"> Reset</button>
      <button type="button" class="btn btn-danger hidden" id="btnremove"><span class="glyphicon glyphicon-trash"></span> Remove</button>
    </div>

  </div>
</form>
</div>
